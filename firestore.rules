rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function isAuthenticated() {
      return request.auth != null;
    }

    function isAdmin() {
      return isAuthenticated();
    }

    // Public newsletter opt-ins (anonymous auth allowed)
    match /newsletterLeads/{leadId} {
      allow read: if false;
      allow create: if request.resource.data.email is string
        && request.resource.data.email.size() > 3
        && request.resource.data.email.size() <= 320
        && (!('source' in request.resource.data) ||
            (request.resource.data.source is string && request.resource.data.source.size() <= 200));
    }

    // Collections read by the public site, written via admin
    match /siteSettings/{docId}         { allow read: if true; allow write: if isAdmin(); }
    match /services/{docId}             { allow read: if true; allow write: if isAdmin(); }
    match /serviceDetails/{docId}       { allow read: if true; allow write: if isAdmin(); }
    match /testimonials/{docId}         { allow read: if true; allow write: if isAdmin(); }
    match /pricingTiers/{docId}         { allow read: if true; allow write: if isAdmin(); }
    match /pricingPages/{docId}         { allow read: if true; allow write: if isAdmin(); }
    match /projects/{docId}             { allow read: if true; allow write: if isAdmin(); }
    match /blogPosts/{docId}            { allow read: if true; allow write: if isAdmin(); }
    match /faqs/{docId}                 { allow read: if true; allow write: if isAdmin(); }
    match /socialLinks/{docId}          { allow read: if true; allow write: if isAdmin(); }
    match /homepageSettings/{docId}     { allow read: if true; allow write: if isAdmin(); }
    match /homepageContent/{docId}      { allow read: if true; allow write: if isAdmin(); }
    match /aboutPageSettings/{docId}    { allow read: if true; allow write: if isAdmin(); }

    match /{document=**} {
      allow read: if true;
      allow write: if false;
    }
  }
}